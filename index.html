<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EnergizeOS™ News Aggregator</title>
  <link rel="stylesheet" href="styles/main.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    h1 {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      font-weight: bold;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      padding: .75rem 1rem;
    }
    #toolbar {
      display: flex;
      align-items: center;
      gap: .5rem;
      flex-wrap: wrap;
    }
    #lastUpdated {
      font-size: 12px;
      opacity: .7;
      white-space: nowrap;
    }
    #pagination {
      padding: 0 1rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>EnergizeOS™ News Aggregator</h1>
    <div id="toolbar">
      <input type="text" id="searchBox" placeholder="Search news..." />
      <button id="langToggle">中文</button>
      <!-- 新增：显示聚合内容的最后更新时间（自动填充） -->
      <span id="lastUpdated" aria-live="polite"></span>
    </div>
  </header>

  <div id="pagination"></div>

  <main id="newsContainer">
    <!-- News content will be loaded here -->
  </main>

  <!-- 业务脚本 -->
  <script src="components/search.js"></script>
  <script src="components/langToggle.js"></script>
  <script src="components/pagination.js"></script>
  <script src="components/footer.js"></script>

  <!-- 新增：自动读取 posts/page1.html 的更新时间（优先 Last-Modified，回退到 HTML 注释） -->
  <script>
    (async () => {
      const el = document.getElementById('lastUpdated');
      if (!el) return;

      const bust = Date.now(); // 缓存穿透
      try {
        // 1) 先用 HEAD 读 Last-Modified
        let lm = '';
        const head = await fetch(`posts/page1.html?meta=${bust}`, { method: 'HEAD' });
        if (head.ok) lm = head.headers.get('Last-Modified') || '';

        // 2) 如果没有，就 GET 内容读取顶端的注释 <!-- Last Updated: ... -->
        if (!lm) {
          const txt = await (await fetch(`posts/page1.html?meta=${bust}`)).text();
          const m = txt.match(/<!--\s*Last Updated:\s*([^>]+)\s*-->/i);
          lm = m ? m[1].trim() : '';
        }

        if (lm) {
          // 兼容两类格式：
          // a) Sat, 16 Aug 2025 07:18:35 GMT  (HTTP Last-Modified)
          // b) 2025-08-16 07:18 UTC           (我们生成的注释)
          let d;
          if (/GMT|UTC/i.test(lm) || lm.includes(',')) {
            d = new Date(lm);
          } else {
            const m2 = lm.match(/(\d{4}-\d{2}-\d{2})[ T](\d{2}:\d{2})(?::\d{2})?\s*UTC/i);
            d = m2 ? new Date(`${m2[1]}T${m2[2]}:00Z`) : new Date(lm);
          }

          if (!isNaN(d)) {
            const utcStr = d.toISOString().replace('.000','').replace('T',' ').replace('Z',' UTC');
            const localStr = d.toLocaleString();
            el.textContent = `Last Updated: ${utcStr} · Local: ${localStr}`;
            el.title = `Source: posts/page1.html (cache-bust=${bust})`;
          } else {
            el.textContent = `Last Updated: ${lm}`;
          }
        } else {
          el.textContent = '';
        }
      } catch (e) {
        console.warn('LastUpdated check failed', e);
      }
    })();
  </script>
</body>
</html>
